<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>《喜羊羊与灰太狼》羊村守护者系列音乐资源包</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #e0f7fa;
            color: #333;
            margin: 0;
            padding: 0;
        }
        
        .js-disabled-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            color: #ff4081;
            z-index: 100;
        }
        
        .container {
            display: none;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            color: #ff4081;
        }
        
        h2 {
            font-size: 1.8em;
            color: #ff4081;
        }
        
        .code {
            background-color: #f6f6f6;
            border-radius: 2px;
            padding: 2px;
            font-family: 'Courier New', Courier, monospace;
        }
        
        footer {
            text-align: center;
            padding-left: 20px;
            padding-right: 20px;
            margin-top: 20px;
            font-size: 0.8em;
            color: #888;
        }
        
        .console {
            width: 90%;
            margin-top: 20px;
            background-color: #000;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .output {
            height: 180px;
            overflow-y: auto;
            white-space: pre-wrap;
            background-color: #222;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.6em;
        }
            
        .log-entry {
            display: block;
            margin-bottom: 5px;
        }
        
        .log-timestamp {
            color: #C4A000; /* 时间戳颜色 */
        }
        
        .log-type {
            color: #4D9706; /* INFO信息颜色 */
        }
        
        .log-error {
            color: #EF292A; /* ERROR信息颜色 */
        }
        
        .log-timestamp-millisecond {
            color: #fff; /* 默认的白色文本样式 */
        }
        
        .input {
            display: flex;
            margin-top: 10px;
        }
        
        .input input {
            flex-grow: 1;
            background-color: #333;
            color: #fff;
            border: none;
            padding: 10px;
            font-size: 1em;
            border-radius: 5px;
        }
        
        .input button {
            background-color: #4caf50;
            color: #fff;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .input button:hover {
            background-color: #45a049;
        }
        
        audio {
            display: none;
        }
        
        /* 版本选择器样式 */
        .version-selector {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        
        .version-title {
            padding: 5px;
            background-color: #4caf50;
            color: white;
            border-radius: 5px;
            text-align: center;
        }
        
        .version-list {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
            overflow: hidden;
            opacity: 0; 
            transition: opacity 0.3s ease, visibility 0.3s ease !important; 
            visibility: hidden; 
        }
        
        .version-list.show {
            display: block; 
            opacity: 1; 
            visibility: visible; 
        }
        
        .version-item {
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease; 
        }
        
        .version-item:hover {
            background-color: #f0f0f0;
        }
        .custom-link {
            color: #ff4081;
            text-decoration: none;
            font-weight: bold;
            font-family: Arial, sans-serif;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: transparent;
            transition: all 0.3s ease;
            border: 2px solid #ff4081;
        }
        
        .custom-link:hover {
            color: #fff;
            background-color: #ff4081;
            border-color: #ff4081;
        }
        
        .custom-link:active {
            color: #fff;
            background-color: #e01e5a;
            border-color: #e01e5a;
            outline: none; 
        }
        
        .custom-link:focus {
            outline: none;
            border-color: #e01e30;
            box-shadow: 0 0 0 3px rgba(255, 64, 129, 0.5);
        }
        
        .a {
            color: #e01e5a;
        }
    </style>

</head>

<body>
    <div class="container">
    <div class="js-disabled-warning">
        <h2>启用JavaScript</h2>
        <p>您的浏览器未启用JavaScript，请启用JavaScript以正常浏览此页面。</p>
    </div>
        <h1>《喜羊羊与灰太狼》羊村守护者系列音乐资源包</h1>
        <p>作者：闲鱼茶酱呀</p>
        <p>文件大小：12.5MB</p>

        <h2>资源包特色</h2>
        <ul>
            <li>音乐系列：10首《喜羊羊与灰太狼》羊村守护者系列音乐，每一首都带您回到经典的羊村冒险。</li>
            <li>简易使用：只需在Minecraft中输入命令，就能播放您喜爱的主题曲！</li>
            <li>适用版本：Minecraft Bedrock版（版本1.12及以上）</li>
        </ul>

        <h2>如何使用</h2>
        <ul>
            <li>下载并加载资源包文件。</li>
            <li>启动Minecraft游戏，在聊天框输入命令：<br><span class="code">/music play sheep_op_x</span></li>
            <li>其中x是数字，代表不同的主题曲。</li>
            <li>例如：输入<span class="code">/music play sheep_op_10</span>播放《奇侠大营救》主题曲。</li>
        </ul>

        <h2>下载链接</h2>
        <a href="#" id="downloadButton" class="custom-link" download>点击下载资源包</a>
        <br><br>
        <div class="version-selector" id="versionSelector">
            <div class="custom-link">选择版本：<span id="selectedVersion">unknown</span></div>
            <div class="version-list" id="versionList">
                <div class="version-item" data-version="1.00.0">1.00.0</div>
            </div>
        </div>

        <h2>资源包安装步骤</h2>
        <ol>
            <li>下载资源包（zip文件）。</li>
            <li>修改扩展名为mcpack。</li>
            <li>点击文件，选择打开方式为Minecraft。</li>
            <li>在游戏内启用资源包，享受音乐吧！</li>
        </ol>

        <h2>联系作者</h2>
        <p>Email：<a href="mailto:CraftBlockht6x@outlook.com?subject=用户向站主发送的邮件" class="a">CraftBlockht6x@outlook.com</a></p>
        <p>Bilibili：<a href="https://space.bilibili.com/1074586668" class="a">@闲鱼茶酱呀</a></p>
        <h2>音乐投稿</h2>
        <p>欢迎投稿您的《喜羊羊与灰太狼》音乐作品！我们非常期待您的创意和才华，希望能让更多玩家在Minecraft中享受到您的音乐。</p>
        <p>如果您有兴趣投稿，请将您的音乐文件发送至邮箱：<a href="mailto:CraftBlockht6x@outlook.com" class="a">CraftBlockht6x@outlook.com</a>。</p>
        <p>投稿时，请附上以下信息：
        <ul>
            <li>您的名字或昵称</li>
            <li>您的电子邮箱</li>
            <li>音乐文件（支持格式：mp3、ogg等）</li>
            <li>音乐的来源，是否是从动画中提取</li>
            <li>音乐的简要描述</li>
        </ul>
        </p>
        <p>我们会尽快审核您的投稿，并在下次更新中将其添加到资源包中。感谢您的支持！</p>

        <h2>更新记录</h2>
        <ul>
            <li><strong>1.00.0:</strong> 第一个版本，共十首《羊村守护者》音乐。</li>
        </ul>

        <h2>模拟控制台</h2>
        <div class="console">
            <div class="output" id="output"></div>
            <div class="input">
                <input type="text" id="commandInput" placeholder="输入命令..." />
                <button onclick="runCommand()">运行</button>
            </div>
        </div>
    </div>

    <audio id="audioPlayer" controls></audio>

    <footer>
        <p>&copy;《喜羊羊与灰太狼》羊村守护者系列音乐资源包</p>
        <p>版权所有，本资源包由<a href="https://space.bilibili.com/1074586668" style="color: #888;">@闲鱼茶酱呀</a>开发，未经作者允许禁止转载，禁止用于商业用途。</p>
    </footer>

    <script>
        // 检测JavaScript是否启用
        document.addEventListener('DOMContentLoaded', function() {
            // 如果JavaScript正常工作，隐藏警告信息并显示页面内容
            document.querySelector('.js-disabled-warning').style.display = 'none';
            document.querySelector('.container').style.display = 'block';
        });
        
        // 定义每个版本的下载链接
        const downloadLinks = {
            "1.00.0": "pack/v1.00.0/v1.00.0_sheep_op_pack.zip",
            // 添加其他版本的下载链接...
        };
        
        // 获取版本选择器和版本列表元素
        const versionSelector = document.getElementById('versionSelector');
        const versionList = document.getElementById('versionList');
        const selectedVersion = document.getElementById('selectedVersion');
        
        // 显示或隐藏版本列表
        versionSelector.addEventListener('click', function(event) {
            event.stopPropagation();
            if (versionList.classList.contains('show')) {
        versionList.classList.remove('show'); // 收起时移除类
            } else {
        versionList.classList.add('show'); // 展开时添加类
            }
        });
        
        // 处理版本选择
        versionList.addEventListener('click', function(event) {
            if (event.target.classList.contains('version-item')) {
        const selectedVersionValue = event.target.getAttribute('data-version');
        selectedVersion.textContent = selectedVersionValue;
        versionList.classList.remove('show'); // 选择版本后自动收起
            }
        });
        
        // 处理外部点击以关闭版本列表
        window.addEventListener('click', function() {
            if (versionList.classList.contains('show')) {
        versionList.classList.remove('show'); // 点击外部时收起
            }
        });
        
        // 初始化时设置第一个版本为选中状态
        const initialVersionElement = versionList.querySelector('.version-item');
        const initialVersion = initialVersionElement.getAttribute('data-version');
        selectedVersion.textContent = initialVersion;
        
        // 修改下载按钮的点击事件
        const downloadButton = document.getElementById('downloadButton');
        downloadButton.addEventListener('click', function(event) {
            event.preventDefault(); // 阻止默认的链接行为
            const selectedVersionValue = selectedVersion.textContent;
            const downloadUrl = downloadLinks[selectedVersionValue];
            if (downloadUrl) {
        window.location.href = downloadUrl; // 重定向到下载链接
            } else {
        alert('下载链接不可用，请选择一个有效的版本。');
            }
        });
        
        const outputElement = document.getElementById('output');
        const commandInput = document.getElementById('commandInput');
        const audioPlayer = document.getElementById('audioPlayer');
        
        // 定义命令历史数组
        const commandHistory = [];
        let historyIndex = -1;
        
        // 定义可用命令和对应的音乐文件
        const musicFiles = {
            'sheep_op_1': 'music/v1.00.0/sheep_op_1.ogg',
            'sheep_op_2': 'music/v1.00.0/sheep_op_2.ogg',
            'sheep_op_3': 'music/v1.00.0/sheep_op_3.ogg',
            'sheep_op_4': 'music/v1.00.0/sheep_op_4.ogg',
            'sheep_op_5': 'music/v1.00.0/sheep_op_5.ogg',
            'sheep_op_6': 'music/v1.00.0/sheep_op_6.ogg',
            'sheep_op_7': 'music/v1.00.0/sheep_op_7.ogg',
            'sheep_op_8': 'music/v1.00.0/sheep_op_8.ogg',
            'sheep_op_9': 'music/v1.00.0/sheep_op_9.ogg',
            'sheep_op_10': 'music/v1.00.0/sheep_op_10.ogg'
        };
        
        // 音乐播放队列
        const musicQueue = [];
        let currentVolume = 1.0;
        let currentFadeTime = 0;
        let repeatMode = 'play_once';
        
        function fadeVolume(targetVolume, fadeSeconds) {
            const startTime = Date.now();
            const startVolume = audioPlayer.volume;
            const fadeInterval = setInterval(() => {
        const elapsedTime = (Date.now() - startTime) / 1000;
        if (elapsedTime >= fadeSeconds) {
            audioPlayer.volume = targetVolume;
            clearInterval(fadeInterval);
        } else {
            audioPlayer.volume = startVolume + (targetVolume - startVolume) * (elapsedTime / fadeSeconds);
        }
            }, 100); // 每100ms更新一次音量
        }
        
        function runCommand() {
            const command = commandInput.value.trim();
            if (command) {
        // 将命令添加到历史记录中
        commandHistory.push(command);
        historyIndex = commandHistory.length;
        
        // 保存命令历史到localStorage
        localStorage.setItem('commandHistory', JSON.stringify(commandHistory));
            }
        
            const args = command.split(' ');
            const commandName = args[0];
        
            switch (commandName) {
        case '/music':
            handleMusicCommand(args);
            break;
        case '/reload': 
            reloadConsole();
            break;
        case '/help': 
            displayHelp();
            break;
        case '/reset':  // 新增 /reset 命令
            resetConsole();
            break;
        default:
            addOutput(`> ${command}\n未知的命令“${command}”，请确保该命令在模拟控制台是否可用。\n`, "ERROR");
            break;
            }
            commandInput.value = '';
        
            // 保存控制台输出到localStorage
            localStorage.setItem('consoleOutput', outputElement.innerHTML);
        }
        
        // 监听键盘事件
        commandInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
        runCommand();
            } else if (event.key === 'ArrowUp') {
        if (historyIndex > 0) {
            historyIndex--;
            commandInput.value = commandHistory[historyIndex];
        }
            } else if (event.key === 'ArrowDown') {
        if (historyIndex < commandHistory.length - 1) {
            historyIndex++;
            commandInput.value = commandHistory[historyIndex];
        } else {
            historyIndex = commandHistory.length;
            commandInput.value = '';
        }
            }
        });
        
        window.onload = function() {
            // 从localStorage加载命令历史和输出信息
            const storedHistory = JSON.parse(localStorage.getItem('commandHistory')) || [];
            const storedOutput = localStorage.getItem('consoleOutput') || '';
        
            // 恢复命令历史
            commandHistory.push(...storedHistory);
            historyIndex = commandHistory.length;
        
            // 恢复控制台输出
            outputElement.innerHTML = storedOutput;
        };
        
        function resetConsole() {
            commandHistory.length = 0;
            historyIndex = -1;
            outputElement.innerHTML = '';
            localStorage.removeItem('commandHistory');
            localStorage.removeItem('consoleOutput');
            addOutput("> /reset\n模拟控制台缓存已清除。\n", "INFO");
        }
        
        function reloadConsole() {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            musicQueue.length = 0;
            addOutput("> /reload\n模拟控制台已重新加载。\n", "INFO");
        }
        
        function displayHelp() {
            const helpText = `> /help\n获取帮助，命令列表:\n------------------------------------------------------------\n\n·/music\n播放音乐。\n\n· /music play <trackName> [volume] [fadeSeconds] [repeatMode]\n播放指定的音乐文件。\n- trackName: 音乐文件名（如 sheep_op_1）\n- volume: 音量（0.0 到 1.0，默认为 1.0）\n- fadeSeconds: 音量渐变时间（秒，默认为 0）\n- repeatMode: 播放模式（play_once 或 loop，默认为 play_once）\n\n. /music stop [fadeSeconds]\n停止当前播放的音乐。\n- fadeSeconds: 音量渐变时间（秒，默认为 0）\n\n· /music volume <volume>\n设置当前音乐的音量。\n- volume: 音量（0.0 到 1.0）\n\n· /reload\n停止所有正在运行的进程（包括音乐播放）。\n\n·/reset\n清除模拟控制台运行缓存。\n\n·/help\n获取帮助，命令列表。\n\n------------------------------------------------------------\n`;
            addOutput(helpText, "INFO");
        }
        
        function handleMusicCommand(args) {
            const subCommand = args[1];
            switch (subCommand) {
                case 'play':
                    handlePlayCommand(args);
                    break;
                case 'queue':
                    handleQueueCommand(args);
                    break;
                case 'stop':
                    handleStopCommand(args);
                    break;
                case 'volume':
                    handleVolumeCommand(args);
                    break;
                default:
                    addOutput(`> ${commandHistory[historyIndex - 1]}\n语法错误:未添加或使用未知的音乐子命令，请确保已添加子命令或该子命令在模拟控制台是否可用。\n`, "ERROR");
                    break;
            }
        }
        
        function handlePlayCommand(args) {
            if (args.length < 3) {
        addOutput(`> ${commandHistory[historyIndex - 1]}\n用法: /music play <trackName> [volume] [fadeSeconds] [repeatMode]\n`, "INFO");
        return;
            }
        
            const trackName = args[2];
            const volume = parseFloat(args[3]) || 1.0; // 默认音量为1.0
            const fadeSeconds = parseFloat(args[4]) || 0;
            const repeatMode = args[5] || 'play_once';
        
            if (!musicFiles[trackName]) {
        addOutput(`> ${commandHistory[historyIndex - 1]}\n未知的音乐文件: ${trackName}\n`, "ERROR");
        return;
            }
        
            addOutput(`> ${commandHistory[historyIndex - 1]}\n播放音乐: ${trackName}\n`, "INFO");
            playMusic(musicFiles[trackName], volume, fadeSeconds, repeatMode);
        }
        
        function handleStopCommand(args) {
            const fadeSeconds = parseFloat(args[2]) || 0;
            addOutput(`> ${commandHistory[historyIndex - 1]}\n停止音乐，音乐将在 ${fadeSeconds} 秒内停止播放。\n`, "INFO");
            stopMusic(fadeSeconds);
        }
        
        function handleQueueCommand(args) {
            if (args.length < 3) {
        addOutput(`> ${commandHistory[historyIndex - 1]}\n用法: /music queue <trackName> [volume] [fadeSeconds] [repeatMode]\n`, "INFO");
        return;
            }
        
            const trackName = args[2];
            const volume = parseFloat(args[3]) || currentVolume;
            const fadeSeconds = parseFloat(args[4]) || currentFadeTime;
            const repeatMode = args[5] || 'play_once';
        
            if (!musicFiles[trackName]) {
        addOutput(`> ${commandHistory[historyIndex - 1]}\n未知的音乐文件: ${trackName}\n`, "ERROR");
        return;
            }
        
            addOutput(`> ${commandHistory[historyIndex - 1]}\n将音乐添加到队列: ${trackName}\n`, "INFO");
            musicQueue.push({ file: musicFiles[trackName], volume, fadeSeconds, repeatMode });
        }
        
        function handleVolumeCommand(args) {
            if (args.length < 3) {
                addOutput(`> ${commandHistory[historyIndex - 1]}\n用法: /music volume <volume>\n`, "INFO");
                return;
            }
        
            const volume = parseFloat(args[2]);
            if (volume < 0 || volume > 1) {
                addOutput(`> ${commandHistory[historyIndex - 1]}\n音量必须在0到1之间。\n`, "ERROR");
                return;
            }
        
            currentVolume = volume;
            audioPlayer.volume = currentVolume;
            addOutput(`> ${commandHistory[historyIndex - 1]}\n音量已设置为: ${volume}\n`, "INFO");
        }
        
        function playMusic(file, volume, fadeSeconds, repeatMode) {
            audioPlayer.src = file;
            audioPlayer.loop = repeatMode === 'loop';
            audioPlayer.play();
        
            // 使用默认音量值（1.0），除非指定了其他音量
            volume = volume || 1.0;
        
            // 如果有渐变时间，则使用渐变逻辑
            if (fadeSeconds > 0) {
        fadeVolume(volume, fadeSeconds);
            } else {
        audioPlayer.volume = volume;
            }
        
            // 更新全局音量变量
            currentVolume = volume;
        
            // 监听播放结束事件
            audioPlayer.addEventListener('ended', function() {
        // 播放队列中的下一首音乐
        if (musicQueue.length > 0) {
            const nextTrack = musicQueue.shift(); // 获取队列中的下一首音乐
            playMusic(nextTrack.file, nextTrack.volume, nextTrack.fadeSeconds, nextTrack.repeatMode);
            }
                });
            }
            
            function stopMusic(fadeSeconds) {
                if (fadeSeconds > 0) {
            fadeVolume(0, fadeSeconds);
            setTimeout(() => {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                audioPlayer.volume = 1.0; // 重置音量为默认值
            }, fadeSeconds * 1000);
                } else {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.volume = 1.0; // 重置音量为默认值
                }
            }
            
            function addOutput(message, type = 'INFO') {
                // 获取当前时间，并格式化为 "YYYY-MM-DD HH:MM:SS" 和 "mmm" 的形式
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0'); // 月份从0开始计数，所以加1
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                const milliseconds = String(now.getMilliseconds()).padStart(3, '0');
                const timestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                const fullTimestamp = `${timestamp}:${milliseconds}`;
            
                // 根据类型设置颜色
                const coloredType = type === 'ERROR' ? `<span class="log-error">${type}</span>` : `<span class="log-type">${type}</span>`;
            
                // 构造日志条目，将毫秒及其前导冒号设置为默认颜色
                const logEntry = `<div class="log-entry">[<span class="log-timestamp">${timestamp}<span class="log-timestamp-millisecond">:${milliseconds}</span></span> ${coloredType}] ${message}</div>`;
                outputElement.innerHTML += logEntry;
                outputElement.scrollTop = outputElement.scrollHeight;
            }
            
    </script>
</body>
</html>
